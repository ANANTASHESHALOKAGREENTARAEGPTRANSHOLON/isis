[[_ug_reference-services-spi_manpage-CommandService]]
= `CommandService`
:Notice: Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements. See the NOTICE file distributed with this work for additional information regarding copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at. http://www.apache.org/licenses/LICENSE-2.0 . Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR  CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.
:_basedir: ../
:_imagesdir: images/

IMPORTANT: TODO


== Isis Addons Implementation

For 1.7.0+, see the http://github.com/isisaddons/isis-module-command[Isis addons' Command module] (non-ASF).


Title: CommandService (isis-module-command-jdo)

The `CommandService` service supports the xref:_ug_reference-services-api_manpage-CommandContext[`CommandContext`] service such that `Command` objects (that reify the invocation of an action on a domain object into an object) can be persisted.

Persistent `Command`s support several use cases:

* they enable profiling of the running application (which actions are invoked then most often, what is their response time)
* they act as a parent to any background commands that might be invoked through the xref:_ug_reference-services-api_manpage-BackgroundService[`BackgroundService`]
* if xref:_ug_reference-services-spi_manpage-AuditingService[auditing] is configured, they provide better audit informatio, since the `Command` (the 'cause' of an action) can be correlated to the audit records (the "effect" of the action) through the unique `transactionId` GUID
* if xref:_ug_reference-services-spi_manpage-PublishingService[publishing] is configured, they provide better traceability as the `Command` is also correlated with any published events, again through the unique `transactionId` GUID
* the associated xref:_ug_reference-annotations_manpage-Action_command[`@Action#command()`] annotation attribute also allows action invocations to be performed in the background. In this case the act of invoking the action on an object instead returns the `Command` to the user.


[[_ug_reference-services-spi_manpage-CommandService_screencast]]
== Screencast

The screencast provides a run-through of the command (profiling) service, auditing service, publishing service. It also shows how commands can be run in the background either explicitly by scheduling through the background service or implicitly by way of a framework annotation.

<iframe width="560" height="315" src="//www.youtube.com/embed/tqXUZkPB3EI" frameborder="0" allowfullscreen></iframe>

== API

The `CommandService` service defines the following very simple API:

[source,java]
----
public interface CommandService {

    @Programmatic
    Command create();

    @Programmatic
    void startTransaction(final Command command, final UUID transactionId);

    @Programmatic
    void complete(final Command command);

    @Programmatic
    boolean persistIfPossible(Command command);

    }
----

where `Command` is defined as defined by the xref:_ug_reference-services-api_manpage-CommandContext[`CommandContext`] service.




== Implementation

=== CommandService (for persistent `Command`s)

The `CommandService` interface (defined in the Isis applib) is implemented within `isis-module-command-jdo` by:

* `org.apache.isis.objectstore.jdo.applib.service.command.CommandServiceJdo`

There is also a supporting repository to query persisted `Command`s:

* `org.apache.isis.objectstore.jdo.applib.service.command.CommandServiceJdoRepository`

In addition, there is a supporting contributions service that contributes actions for searching for persisted `Command`s for any object:

* `org.apache.isis.objectstore.jdo.applib.service.command.CommandServiceJdoContributions`





== Registering the Services

Assuming that the `configuration-and-annotation` services installer is configured:

[source,ini]
----
isis.services-installer=configuration-and-annotation
----

then the services are automatically registered if the `isis-module-command-jdo` Maven module
is on the classpath (they are annotated with `@DomainService`).




== Related Services

As discussed above, this service supports the xref:_ug_reference-services-api_manpage-CommandContext[`CommandContext`], providing the ability for `Command` objects to be
persisted. This is closely related to the xref:_ug_reference-services-spi_manpage-BackgroundCommandService[`BackgroundCommandService`]that allows the xref:_ug_reference-services-api_manpage-BackgroundService[`BackgroundService`] to schedule commands for background/asynchronous execution.

The implementations of `CommandService` and `BackgroundCommandService` are intended to go together, so that persistent parent `Command`s can be associated with their child background `Command`s.